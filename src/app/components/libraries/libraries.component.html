<app-navbar></app-navbar>

<div class="libraries-container">
  <div class="container">
    <div class="header">
      <div class="header-content">
        <div>
          <h2>Mis Bibliotecas</h2>
          <p class="subtitle">Gestiona tu colección de libros</p>
        </div>
        <button class="btn btn-primary" (click)="openCreateModal()" type="button">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"/>
            <line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
          Nueva biblioteca
        </button>
      </div>
    </div>

    @if (isLoading()) {
      <div class="loading">
        <div class="spinner"></div>
        <p>Cargando bibliotecas...</p>
      </div>
    }

    @if (errorMessage()) {
      <div class="alert alert-error">
        {{ errorMessage() }}
      </div>
    }

    @if (!isLoading() && !errorMessage()) {
      @if (libraries().length === 0) {
        <div class="empty-state">
          <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
          </svg>
          <h3>No tienes bibliotecas aún</h3>
          <p>Crea tu primera biblioteca para comenzar a organizar tu colección</p>
        </div>
      } @else {
        <div class="table-wrapper">
          <table class="libraries-table">
            <thead>
              <tr>
                <th>Nombre</th>
                <th>Descripción</th>
                <th class="books-header">Libros</th>
                <th>Fecha de creación</th>
                <th class="actions-header">Acciones</th>
              </tr>
            </thead>
            <tbody>
              @for (library of libraries(); track library.id) {
                <tr>
                  <td class="library-name">
                    <div class="name-cell">
                      <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/>
                        <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/>
                      </svg>
                      <span>{{ library.name }}</span>
                    </div>
                  </td>
                  <td class="library-description">{{ library.description }}</td>
                  <td class="library-books">
                    <span class="badge">
                      {{ library.books.length }}
                    </span>
                  </td>
                  <td class="library-date">{{ library.createdAt | date: 'dd/MM/yyyy' }}</td>
                  <td class="library-actions">
                    <a [routerLink]="['/libraries', library.id, 'books']" class="btn-icon" title="Ver libros">
                      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
                        <circle cx="12" cy="12" r="3"/>
                      </svg>
                    </a>
                    <button (click)="openEditModal(library)" class="btn-icon" title="Editar" type="button">
                      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                      </svg>
                    </button>
                    <button (click)="openDeleteModal(library)" class="btn-icon btn-icon-danger" title="Eliminar" type="button">
                      <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="3 6 5 6 21 6"/>
                        <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
                        <line x1="10" y1="11" x2="10" y2="17"/>
                        <line x1="14" y1="11" x2="14" y2="17"/>
                      </svg>
                    </button>
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
        
        <app-pagination
          [currentPage]="currentPage()"
          [totalPages]="totalPages()"
          [totalItems]="totalItems()"
          [itemsPerPage]="itemsPerPage()"
          (pageChange)="onPageChange($event)"
          (itemsPerPageChange)="onItemsPerPageChange($event)"
        />
      }
    }
  </div>
</div>

@if (showCreateModal()) {
  <app-create-library-modal
    (closeModal)="closeCreateModal()"
    (libraryCreated)="onLibraryCreated()"
  />
}

@if (showEditModal() && selectedLibrary()) {
  <app-edit-library-modal
    [library]="selectedLibrary()!"
    (closeModal)="closeEditModal()"
    (libraryUpdated)="onLibraryUpdated()"
  />
}

@if (showDeleteModal() && selectedLibrary()) {
  <app-delete-library-modal
    [library]="selectedLibrary()!"
    (closeModal)="closeDeleteModal()"
    (libraryDeleted)="onLibraryDeleted()"
  />
}

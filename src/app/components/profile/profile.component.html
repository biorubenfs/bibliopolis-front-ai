<app-navbar></app-navbar>

<div class="profile-container">
  <div class="container">
    <div class="header">
      <div class="header-text">
        <h2>Mi Perfil</h2>
        <p class="subtitle">Administra tu información personal y seguridad</p>
      </div>
      <div class="avatar-large">
        <img [src]="avatarUrl()" alt="Avatar" />
      </div>
    </div>

    <div class="profile-grid">
      <!-- Profile Information Section -->
      <div class="profile-section">
        <div class="section-card">
          <div class="section-header">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
              <circle cx="12" cy="7" r="4"/>
            </svg>
            <h3>Información Personal</h3>
          </div>

          @if (profileSuccessMessage()) {
            <div class="alert alert-success">
              {{ profileSuccessMessage() }}
            </div>
          }

          @if (profileErrorMessage()) {
            <div class="alert alert-error">
              {{ profileErrorMessage() }}
            </div>
          }

          <form [formGroup]="profileForm" (ngSubmit)="onSubmitProfile()">
            <div class="form-group">
              <label for="name">Nombre completo *</label>
              <input
                id="name"
                type="text"
                formControlName="name"
                placeholder="Ingresa tu nombre"
                [class.error]="name?.invalid && name?.touched"
              />
              @if (name?.invalid && name?.touched) {
                <span class="error-message">
                  @if (name?.errors?.['required']) {
                    El nombre es obligatorio
                  }
                  @if (name?.errors?.['minlength']) {
                    El nombre debe tener al menos 2 caracteres
                  }
                </span>
              }
            </div>

            <div class="form-actions">
              <button
                type="submit"
                class="btn btn-primary"
                [disabled]="isSubmittingProfile()"
              >
                @if (isSubmittingProfile()) {
                  Actualizando...
                } @else {
                  Actualizar Perfil
                }
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Password Section -->
      <div class="password-section">
        <div class="section-card">
          <div class="section-header">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
              <path d="M7 11V7a5 5 0 0 1 10 0v4"/>
            </svg>
            <h3>Cambiar Contraseña</h3>
          </div>

          @if (passwordSuccessMessage()) {
            <div class="alert alert-success">
              {{ passwordSuccessMessage() }}
            </div>
          }

          @if (passwordErrorMessage()) {
            <div class="alert alert-error">
              {{ passwordErrorMessage() }}
            </div>
          }

          <form [formGroup]="passwordForm" (ngSubmit)="onSubmitPassword()">
            <div class="form-group">
              <label for="currentPassword">Contraseña actual *</label>
              <input
                id="currentPassword"
                type="password"
                formControlName="currentPassword"
                placeholder="Ingresa tu contraseña actual"
                [class.error]="currentPassword?.invalid && currentPassword?.touched"
              />
              @if (currentPassword?.invalid && currentPassword?.touched) {
                <span class="error-message">
                  @if (currentPassword?.errors?.['required']) {
                    La contraseña actual es obligatoria
                  }
                  @if (currentPassword?.errors?.['maxlength']) {
                    La contraseña no puede exceder 20 caracteres
                  }
                </span>
              }
            </div>

            <div class="form-group">
              <label for="newPassword">Nueva contraseña *</label>
              <input
                id="newPassword"
                type="password"
                formControlName="newPassword"
                placeholder="Ingresa tu nueva contraseña"
                [class.error]="newPassword?.invalid && newPassword?.touched"
              />
              @if (newPassword?.invalid && newPassword?.touched) {
                <span class="error-message">
                  @if (newPassword?.errors?.['required']) {
                    La nueva contraseña es obligatoria
                  }
                  @if (newPassword?.errors?.['minlength']) {
                    La contraseña debe tener al menos 6 caracteres
                  }
                  @if (newPassword?.errors?.['maxlength']) {
                    La contraseña no puede exceder 20 caracteres
                  }
                </span>
              }
            </div>

            <div class="form-actions">
              <button
                type="submit"
                class="btn btn-primary"
                [disabled]="isSubmittingPassword()"
              >
                @if (isSubmittingPassword()) {
                  Cambiando...
                } @else {
                  Cambiar Contraseña
                }
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
